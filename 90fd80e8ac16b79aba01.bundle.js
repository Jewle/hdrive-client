(()=>{var e,t,s={2549:(e,t,s)=>{"use strict";s.d(t,{O:()=>o});var i=s(5715),r=s(965);async function n(e,{email:t,password:s,name:r},n){try{const o=await fetch(i.A.authUrl(e),{method:"POST",body:JSON.stringify({email:t,password:s,name:r}),headers:{"Content-Type":"application/json"}}),a=await o.json();if(o.ok)return a?.token&&n(a.token),a.user;throw{status:o.status}}catch(e){throw e}}const o=new class{get token(){return localStorage.getItem("token")}async login(e,t){return n("login",{email:e,password:t},this.setToLs)}get isAuth(){return this.token?(new r.E).get(i.A.authUrl("isAuth")):Promise.reject(!1)}logOut(){this.setToLs("")}setToLs(e){localStorage.setItem("token",e)}async register(e,t,s){return n("register",{email:e,password:t,name:s},(()=>{}))}}},7189:(e,t,s)=>{var i={"./folders/folders.template.js":[7779,779],"./gservices/folder.widget/folder.widget.template.js":[1826,826],"./item/item.template.js":[7638,638],"./main/main.template.js":[6139,139],"./menu/menu.template.js":[1711,711],"./paginator/paginator.template.js":[3800,800],"./register/register.template.js":[8297,297],"./search/search.template.js":[9910,910],"./selection/selection.template.js":[8595,595],"./start/start.template.js":[9860,387],"./uploader/uploader.template.js":[3947,947]};function r(e){if(!s.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],r=t[0];return s.e(t[1]).then((()=>s(r)))}r.keys=()=>Object.keys(i),r.id=7189,e.exports=r},4298:(e,t,s)=>{"use strict";s.d(t,{$p:()=>a,LB:()=>i,UW:()=>r,jg:()=>n,mx:()=>o});const i="https://hdrive-server.onrender.com/",r="https://hdrive-server.onrender.com/api/",n="https://hdrive-server.onrender.com/public/",o="https://hdrive-server.onrender.com/files",a="http://localhost:4200/"},4309:(e,t,s)=>{"use strict";s.d(t,{h:()=>o});var i=s(2549);const r=new class extends class{capture(){throw new Error("Fuck, provide capture in your Interceptor")}}{authService=i.O;constructor(){super()}capture(e){const t=JSON.parse(JSON.stringify(e));return this.authService.token&&(t.headers={...t.headers,Authorization:`Bearer ${this.authService.token} `}),t}};var n=s(138);class o{async wrapFetch(e,t){try{t=r.capture(t);const s=await fetch(e,t);return await s.json()}catch(e){throw n.log(e),e}}async wrapXHR_TEST(e){const t=r.authService.token;e.setRequestHeader("Authorization",`Bearer ${t}`)}}},965:(e,t,s)=>{"use strict";s.d(t,{E:()=>o});var i=s(4309);function r(e,t,s="get"){const i={headers:{"Content-Type":e},method:s=s.toUpperCase()};return"GET"!==s&&(i.body=JSON.stringify(t)),i}var n=s(5715);class o extends i.h{async get(e,t={}){return e=this._applyQueryString(e,t),this.wrapFetch(e,r("application/json",{},"get"))}async post(e,t,s="application/json"){if(!Object.keys(t).length)throw"Fuck you didnt provide body";return this.wrapFetch(e,r(s,t,"post"))}async put(e,t,s="application/json"){if(!Object.keys(t).length)throw"Fuck you didnt provide body";return this.wrapFetch(e,r(s,t,"put"))}async delete(e,t,s="application/json"){if(!Object.keys(t).length)throw"Fuck you didnt provide body";return this.wrapFetch(e,r(s,t,"delete"))}_applyQueryString=n.A.resolveQueryString}},5715:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var i=s(4298);class r{static filesUrl(e,t={}){const{id:s,token:n}=t;switch(e){case"getAll":return r.resolveQueryString(i.UW+"main/files",{page:t.page});case"delete":return i.UW+"main/delete";case"upload":return i.UW+"main/upload";case"download":return r.resolveQueryString(i.UW+"download/single",{token:n,id:s});case"switchPublic":return i.UW+"main/switchpublic";case"getOne":return i.UW+"main/file";case"publicDownload":return i.jg+"download/"+s;case"imgSrc":return i.mx;case"viewer":return i.UW+"main/setviewer";case"edit":return i.UW+"main/edit";case"publicView":return r.resolveQueryString(i.$p+"#system/item",{id:t.id});case"searchFiles":return i.UW+"main/searchfiles";case"preview":return i.UW+"main/preview"}}static foldersUrl(e){switch(e){case"getAll":return i.UW+"main/getfolders";case"moveTo":return i.UW+"main/movetofolder";case"content":return i.UW+"main/getfolderscontent";case"create":return i.UW+"main/createfolder";case"rename":return i.UW+"main/renamefolder";case"delete":return i.UW+"main/deletefolder";case"info":return i.UW+"main/folderinfo"}}static authUrl(e){switch(e){case"login":return i.UW+"auth/login";case"register":return i.UW+"auth/register";case"isAuth":return i.UW+"main/isauth"}}static resolveQueryString=(e,t)=>{const s=[];return Object.keys(t).length&&(e+="?",Object.keys(t).forEach((e=>{(e||t[e])&&s.push(e+"="+t[e])}))),e+s.join("&")}}},8546:(e,t,s)=>{"use strict";s.d(t,{F:()=>Z});class i{constructor(e){this.components=e.components||[]}init(){let e=[];this.components.forEach((t=>{"object"==typeof t?e=[...e,t.mainComponent,t.child]:e.push(t)}));const t=e.map((e=>s(7189)(`./${e.className}/${e.className}.template.js`)));return Promise.all(t).then((t=>t.map(((t,s)=>(t.name=e[s].className,t)))))}initRoute(e){return"object"==typeof e?{mainComponent:s(7189)(`./${e.mainComponent.className}/${e.mainComponent.className}.template.js`),child:s(7189)(`./${e.child.className}/${e.child.className}.template.js`)}:s(7189)(`./${e.className}/${e.className}.template.js`)}}class r{$el=null;constructor(e){e instanceof r?this.$el=e.$el:(this.$el="string"==typeof e?[...document.querySelectorAll(e)]:e,this.$el?.length<2&&(this.$el=this.$el[0]))}html(e){return void 0===e?this.$el.innerHTML:(this.$el.innerHTML=e,this)}text(e){return void 0===e?this.$el.textContent:(this.$el.textContent=e,this)}clientRect(){return this.$el.getBoundingClientRect()}append(e){if(this.$el)return e instanceof r?(this.$el.append(e.$el),this):"string"==typeof e?(this.$el.innerHTML+=e,this):(this.$el.append(e),this)}prepend(e){return this.$el.prepend(e.$el),this}get children(){return this.$el.children}get data(){return this.$el.dataset}on(e,t){return this.$el.addEventListener(e,t.bind(this)),this}off(e,t){return this.$el.removeEventListener(e,t),this}click(){this.$el.click()}appendAfter(e,t){return t.after(e),this}val(e){return"INPUT"===!this.$el.tagName?this:void 0===e?this.$el.value:this.$el.value=e}disableSubmit(){this.$el.onsubmit=e=>e.preventDefault()}each(e){return this}get files(){if("INPUT"===this.$el.tagName)return this.$el.files}style(e){return Object.keys(e).forEach((t=>{this.$el.style[t]=e[t]})),this}width(e){return this.$el.style.width=e,this}find(e){return n(this.$el.querySelectorAll(e))}findOne(e){return n(this.$el.querySelector(e))}findChangingElement(){this.$el.closest("[nested]")}get isElementGotten(){return"undefined"!==this.$el}src(e){return"IMG"===this.$el.tagName?e?(this.$el.setAttribute("src",e),this):this.$el.getAttribute("src"):null}clear(){return this.$el.innerHTML="",this.$el.remove(),null}attr(e,t){return t?(this.$el.setAttribute(e,t),this):this.$el.getAttribute(e)}takeOne(e=0){if(this.$el?.length>0&&this.$el[e])return n(this.$el[e])}closest(e){return n(this.$el.closest(e))}css(e,t){const s=this.$el.classList;switch(e){case"add":default:s.add(t);break;case"toggle":s.toggle(t);break;case"remove":s.remove(t);break;case"contains":return s.contains(t)}return this}hclass(e,t){return t&&this.css("toggle",e),this}hide(){return this.$el.style.display="none",this}show(){return this.$el.style.display="block",this}remove(){return this.$el.remove(),!0}}function n(e){return new r(e)}n.create=(e,t={})=>{const{classes:s,data:i}=t,n=document.createElement(e);return s&&n.setAttribute("class",s),i&&Object.keys(i).forEach((e=>{n.setAttribute(`data-${e}`,i[e])})),new r(n)};class o{constructor(){this.listeners={}}subscribe(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}emit(e,t){e.toString(),this.listeners[e]=this.listeners[e]||[],this.listeners[e].forEach((e=>{e(t)}))}debounceEmit(e,t,s){setTimeout((()=>{this.emit(e,t)}),s)}vanish(e){e.forEach((e=>{delete this.listeners[e]}))}}var a=s(965),l=s(5715),c=s(6012),h=s.n(c),d=s(4298);const u={files:[],filesToWatch:[],loading:!0,page:null,pages:null},p={uploadingFile:{}};var m=s(138);const f={file:{},error:!1,loading:!1},g={user:{}},v=function(e){let t={},s={},i={},r={},n={},o=[],a=[void 0],l=[];return{subscribe:e=>(o.push(e),{unsubscribe(){o.filter((e=>e!==callback))}}),onReducerStateChanged:(e,t)=>(r[e]=r[e]||[],r[e].push(t),{unsub(){r[e].filter((e=>e.toString()!==t.toString()))}}),onPropertyChange:(e,t)=>(l.push({cb:t,prop:e}),{unsubscribe(){l.filter((t=>t.prop!==e))}}),dispatch:e=>{n=t||{},i=JSON.parse(JSON.stringify(s))||{},a.forEach((t=>{const{name:i,func:r}=t;s[i]=r(s[t.name],e)})),l.forEach(c),Object.keys(r).forEach((e=>{r[e].forEach((t=>{!function(e,t){if(!s)return;JSON.stringify(s[e])!==JSON.stringify(i[e])&&t(s[e])}(e,t)}))})),o.length>0&&o.forEach((e=>{"function"==typeof e&&e(s)}))},getTestState:(e="")=>e?s[e]:s,combineReducers(e){return a=e,this},getState:()=>t,clearState:()=>(t={},s={},!0),selector:e=>t[e],dev(){m.log(r,o)}};function c(e){t&&JSON.stringify(t[e.prop])!==JSON.stringify(n[e.prop])&&e.cb(t[e.prop])}}().combineReducers([{name:"userReducer",func:function(e=g,t){return"USER_ENTERED"===t.type?{user:t.payload}:e}},{name:"filesReducer",func:function(e=u,t){switch(t.type){case"FILES_LOADED":{const{files:s,pages:i,page:r}=t.payload;return{...e,files:s,pages:i,page:r,loading:!1}}case"FILE_EDITED":{const{fileId:s,newTitle:i}=t.payload,r=e.files.map((e=>({...e}))),n=r.find((e=>e._id===s));return n&&(n.originalName=i),{...e,files:r}}case"FILE_DELETED":{const{fileId:s}=t.payload,i=e.files.filter((e=>e._id!==s));return{...e,files:i}}case"FILE_UPLOAD":return{...e,files:[]};case"OBSERVABLE_FILES_LOADED":return{...e,filesToWatch:t.payload};case"FILES_PENDING":{const{page:s}=t.payload,i=e.page!==s?[]:e.files;return{...e,files:i,loading:!0}}case"FILES_REMOVE_MANY":{const{ids:s}=t.payload;let i=e.files.map((e=>({...e})));return s.forEach((e=>{i=i.filter((t=>t._id!==e))})),{...e,files:i}}default:return e}}},{name:"uploadReducer",func:function(e=p,t){return"SET_UPLOADING_FILE"===t.type?{uploadingFile:t.payload}:e}},{name:"itemReducer",func:function(e=f,t){switch(t.type){case"FILE_PENDING":return{...e,loading:!0};case"LOAD_FILE":{const{error:e,file:s}=t.payload;return{file:s,error:e,loading:!1}}default:return e}}}]);v.subscribe((e=>{localStorage.setItem("state",JSON.stringify(v.getTestState()))}));var y=s(138);const w=new class{fetchCore=new a.E;hstore=v;getFiles(e){const t=this.hstore.getTestState("filesReducer"),s=e===t?.page;if(t&&t?.files?.length>0&&s){const{files:e,pages:s}=t;return Promise.resolve({files:e,pages:s,cached:!0})}return e=e||1,this.fetchCore.get(l.A.filesUrl("getAll",{page:e}))}getFile(e){const t=l.A.filesUrl("getOne");return this.fetchCore.get(t,{id:e})}deleteOne(e){return this.fetchCore.delete(l.A.filesUrl("delete"),{id:e})}switchPublic(e){return this.fetchCore.put(l.A.filesUrl("switchPublic"),{id:e}).then((t=>(t.isPublic&&h()(l.A.filesUrl("publicView",{id:e})),t)))}searchViewers(e,t){return this.fetchCore.post(d.UW+"main/searchviewers",{val:e,fileId:t})}filesICanWatch(){y.log(this.hstore.getTestState());const{filesToWatch:e}=this.hstore.getTestState("filesReducer");return e.length>0?Promise.resolve(e):this.fetchCore.get(d.UW+"main/getfilestowatch")}searchFiles(e){return e?this.fetchCore.post(l.A.filesUrl("searchFiles"),{query:e}):Promise.resolve()}editFile(e,t){return this.fetchCore.put(l.A.filesUrl("edit"),{fileId:e,newTitle:t})}download(e){return this.fetchCore.get(l.A.filesUrl("publicDownload",{id:e}))}preview(e){return this.fetchCore.get(l.A.filesUrl("preview"),{id:e})}setViewer(e,t){return this.fetchCore.put(l.A.filesUrl("viewer"),{fileId:e,viewerId:t})}removeViewer(e,t){return this.fetchCore.post(d.UW+"main/removeviewer",{fileId:e,viewerId:t})}};class b{constructor(e={}){this.components=e.components||[],this.selector=n(e.selector),this.routlet=null,this.options={...e.options,emitter:new o,store:v},this.currentRouteComponent=null}prepareComponent(e){if(!e||"function"!=typeof e)return{component:{init:()=>{}},domElement:{}};const t=n.create("div",{classes:e.className}),s=new e(t,this.options);return{component:s,domElement:t.html(s.toHTML())}}root(){return this.selector.html(""),this.components=this.components.flatMap((e=>{let t=null,s=null;"object"==typeof e&&(t=this.prepareComponent(e.mainComponent),s=this.prepareComponent(e.child),t.component.children.push(s.component),t.domElement.find(`${e.child.className}-component`).attr("nested","true").append(s.domElement),this.selector.append(t.domElement));const i=this.prepareComponent(e);return i.domElement.$el&&this.selector.append(i.domElement),t&&s?[i.component,t.component,s.component]:i.component})),this.routlet=n.create("router-outlet",{classes:"router"}),this.selector.append(this.routlet),this.selector}initComponents(){return this.root(),this.components.forEach((e=>e.init())),this}pushRoute(e){this.destroyRoute();let t=null,s=null;if("object"==typeof e&&!1!==e.render)return t=this.prepareComponent(e.mainComponent),s=this.prepareComponent(e.child),t.domElement.find(`${e.child.className}-component`).attr("nested","true").append(s.domElement),this.routlet.append(t.domElement),this.currentRouteComponent=t.component,t.component.init(),s.component.init(),void t.component.children.push(s.component);const i=this.prepareComponent(e);this.currentRouteComponent=i.component,this.routlet.append(i.domElement),i.component.init()}destroyRoute(){this.currentRouteComponent&&(this.currentRouteComponent.destroy(),this.currentRouteComponent=null)}destroyComponents(){this.components&&(this.currentRouteComponent&&this.currentRouteComponent.destroy(),this.currentRouteComponent=null,this.components.forEach((e=>{e.destroy&&e.destroy()})),this.components=null,this.routlet.clear())}changeRoute(){this.destroyComponents()}}class ${constructor(e){this.isComponentsLoaded=!1,this.mainComponent=null,this.routableComponents=[],this.components=[],e.components.forEach((e=>{!1!==e.render&&(("object"==typeof e?e.mainComponent:e).routable?this.routableComponents:this.components).push(e)})),this.loader=new i({components:this.components})}async prepareComponents(){if(this.isComponentsLoaded)return Promise.resolve();const e=await this.loader.init();this.components=this.components.map((t=>"object"==typeof t?(this.setHTMLTemplate(t.mainComponent,this.getTemplateObject(e,t.mainComponent)),this.setHTMLTemplate(t.child,this.getTemplateObject(e,t.child)),t):(this.setHTMLTemplate(t,this.getTemplateObject(e,t)),t))),this.mainComponent=new b({components:this.components,selector:"#app"}).initComponents(),this.isComponentsLoaded=!0}getTemplateObject(e,{className:t}){return e.find((e=>e.name===t))}setHTMLTemplate(e,t){return e.prototype.toHTML=class{static process(e,t){return(s,...i)=>{const r=document.createElement("div");r.innerHTML=e(s,...i);const n=r.querySelector("[hchange]");return n&&n.setAttribute("hchange",t),r.innerHTML}}}.process(t.HTML,e.className),e}async pushRoute(e){await this.prepareComponents();let t=this.routableComponents.find((t=>("object"==typeof t?t.mainComponent:t).className===e));if("object"!=typeof t){if(t){const e=await this.loader.initRoute(t);t=this.setHTMLTemplate(t,e),this.mainComponent.pushRoute(t)}}else{const e=this.loader.initRoute(t),s=this.setHTMLTemplate(t.mainComponent,await e.mainComponent),i=this.setHTMLTemplate(t.child,await e.child);this.mainComponent.pushRoute({mainComponent:s,child:i})}}remove(){this.isComponentsLoaded=!1,this.mainComponent&&this.mainComponent.changeRoute()}}function F(e){const{url:t,qParams:s}=JSON.parse(e.attr("hrouter")),i=l.A.resolveQueryString(t,s);e.attr("hrouter"," "),e.attr("href",i)}class S extends class{constructor(e,t){this.$root=e,this.listeners=t.listeners,this.useRouterAPI=t.useRouterAPI||!1,this.emitter=t.emitter}initDomListeners(){this.listeners=this.listeners||[],this.listeners.forEach((e=>{if(e){const t="on"+e[0].toUpperCase()+e.substring(1,e.length),s=this;this[t]&&this.$root.on(e,this[t].bind(s))}}))}routerDirectivesResolve(){if(!this.useRouterAPI)return;const e=this.$root.find("[hrouter]");e.$el?e.each(F):this.emitter.subscribe("filesLoaded",(()=>{this.$root.find("[hrouter]").each(F)}))}removeEventListeners(){this.listeners&&this.listeners.forEach((e=>{this.$root.off(e)}))}}{storeSubscribe=null;constructor(e,t){super(e,t),this.changeDetection=t.changeDetection,this.changeDetectionOfReducer=t.changeDetectionOfReducer,this.extractFromReducer=t.extractFromReducer,this.hstore=t.store}children=[];toHTML(){}init(){return this.changeDetectionOfReducer&&this.hstore.onReducerStateChanged(this.changeDetectionOfReducer,(e=>{const t=e[this.extractFromReducer],{loading:s,error:i}=e;this.detectChanges(t,s,i),this.onStateChanged()})),this.initDomListeners(),this.routerDirectivesResolve(),this}callUserFunction(e,t,s=[]){if(!e||s.includes(e))return;const i=e.trim().toLowerCase()+"Function",r=this[i];if(!r)throw`No function with name ${i}`;if("function"!=typeof r)throw`${i} is not a function`;this[i].call(this,t)}detectChanges(e,...t){const s=this.constructor.className,i=this.toHTML(e,...t),r=document.createElement("div");r.insertAdjacentHTML("beforeend",i);const n=r.querySelector("[hchange]"),o=this.$root.findOne(`[hchange=${s}]`);o.$el&&o.html(n.innerHTML),r.remove()}destroy(){return this.storeSubscribe&&this.storeSubscribe.unsubscribe(),this.removeEventListeners(),setTimeout((e=>this.$root.clear()),200),0!==this.children.length&&(this.children.forEach((e=>e.destroy())),this.children=[]),this.$root.style({opacity:"0",transition:"0.7s"}),this}useState(){this.detectChanges(this.hstore.selector(this.changeDetection),!0)}onStateChanged(){}static routable=!1}var E=s(2549);function O(){let e=[],t=[],s="",i="",r=null,n=[],o="",a=[],l=[],c={mode:"",field:""},h={},d=[];function u(e){if(!e.hidden)return`<button  ${e.dataAttrs?e.dataAttrs.map((e=>`data-${e.k} = "${e.v}" `)).join(""):""} class="${e.className}">${e.title}</button>`}function p(e){return e?`<li ${e.dataAttrs?e.dataAttrs.map((e=>`data-${e.k} = "${e.v}" `)).join(""):""} class="${e.className}">${e.title}</li>`:""}return{buttons(t){e=t},addBodyButtons(e){l=e},addHeaderButtons(e){d=e},addButtons(t){e=e.concat(t)},dataList(e){t=e},directory(e){o=e},imgSrc(e){s=e},setData(e){c=e},showViewers(e,t){const s=e.map((e=>function(e){const{name:t,email:s,canSee:i,_id:r}=e;return`\n          <div class="file-viewer">\n            <div class="file-viewer-name">${t}</div>\n            <div class="file-viewer-email">${s}</div>\n            <div class="file-viewer-cansee ${i?"obs":""}">\n                <button data-id="${r}" data-mevent="${i?"removeViewer":"setViewer"}">${i?"&times;":"OK"}</button>\n            </div>\n          </div> \n        `}(e))).join("");t.innerHTML=s},modalTitleProvide(e){i=e},provideSearchField(e){h=e},setViewers(e){n=e},async init(n){var a;r=document.createElement("div"),r.classList.add("modal"),setTimeout((e=>{r.style.display="block"}),500),r.insertAdjacentHTML("beforeend",`\n                <div data-modal="close" class="modal-wrapper"></div>\n                <div class="modal-container">\n                     <div class="modal-header">\n                         <p class="modal-title"> ${i}</p>\n                         ${d.map(u).join("")}\n                    </div>\n                    \n                    <div class="modal-body">\n                        ${s&&`<img src="${s}" alt="">`}\n                         <div class="des">\n                    <div files="fileName" class="desc__filename"></div>\n                    <div class="desc__fileprops">\n                        <ul class="data-list">\n                            ${t.map(p).join("")}\n                             ${o}\n                           \n                        </ul>\n                    </div>\n                    <div class="body-buttons">\n                        ${l.map(u).join("")}\n                    </div>\n                    <div class="whocansee">\n                        <p>Who can see?</p>\n                        ${a=h,`<input ${a.dataAttrs?a.dataAttrs.map((e=>`data-${e.k} = "${e.v}" `)).join(""):""} class="${a.className}" value="${a.value||""}" type="${a.type}">`}\n                        <div class="search-box">\n                            \n                        </div>\n                    </div>\n                    \n\n                </div>\n                    </div>\n                    \n                    <div class="modal-footer">\n                    <button class="btn btn-warning" data-modal='close'>Close</button>\n                      ${e.map(u).join("")}\n                    </div>\n                <div class="modal-overlay">\n                    <div class="modal-overlay-content">Loading...</div>\n                 </div>\n                </div>`),n.append(r),r.addEventListener("click",(async({target:t})=>{const s=r.querySelector(".modal-overlay");if("close"===t.dataset.modal&&this.close(),t.dataset.mevent){const i=[...e,...l,...d].find((e=>e.event===t.dataset.mevent));if(!i&&"function"==typeof i?.callback)return;await i.callback(t,s,r)}})),r.querySelector("input").addEventListener("input",(async({target:e})=>{h.callback(e.value,r.querySelector(".search-box"))}))},close(){e=[],t=[{}],s="",i="",n=[],o="",a=[],l=[],c={},h={},d=[],r.style.display="none",r.remove(),r=null}}}function C(e,t=2){let s=0;for(;e>1024;s++)e/=1024;return parseFloat(e.toFixed(t))+" "+["B","KB","MB","GB","TB","PB"][s]}function k(e){return new Date(e).toLocaleDateString()}var R=s(138);const T=new class{modalObject={};$root={};modes={};mode="normal";constructor(){this.modes={normal:this._normalMode,onlyViewers:this._onlyViewersMode}}onDelete=new Function;onEdit=new Function;init(e,t,s="normal"){return this.modalObject=e,this.mode=s,this.$root=t,this}switchPublic=e=>(t,s)=>{s.style.display="block",w.switchPublic(e).then((e=>{e.msg&&(alert(e.msg),e.isPublic?t.innerHTML="Make Private":t.innerHTML="Make Public",s.style.display="none")}))};delete(e,t){return(s,i)=>{i.style.display="block",w.deleteOne(e).then((s=>{alert(`File ${t} has been deleted`),i.style.display="none","function"==typeof this.onDelete&&this.onDelete(e),this.modalObject.close()})).catch((e=>alert("Some errors occur")))}}_applyViewer(e){return(t,s)=>{s.style.display="block";const i=t.dataset.id;return t.parentNode.classList.add("obs"),t.innerHTML="&times;",t.setAttribute("data-mevent","removeViewer"),w.setViewer(e,i).then((e=>{alert("Now this user can see the file"),s.style.display="none"}))}}_removerViewer(e){return(t,s)=>{s.style.display="block";const i=t.dataset.id;return t.parentNode.classList.remove("obs"),t.innerHTML="OK",t.setAttribute("data-mevent","setViewer"),w.removeViewer(e,i).then((e=>{alert("Now this user cannot see the file"),s.style.display="none"}))}}_download(e){const t={id:e,token:E.O.token},s=l.A.filesUrl("download",t),i=document.createElement("a");i.href=s,i.click(),i.remove()}_searchUsers(e){return(t,s)=>{t?setTimeout((async i=>{let r=await w.searchViewers(t,e);this.modalObject.showViewers(r,s)}),500):s.innerHTML=""}}_newTab(e){return()=>{Z.redirect(`system/item?id=${e}`)}}_editFile(e){let t=!1,s=null,i=null,r=null;return(n,o)=>{if(s=s||document.createElement("input"),t)return o.style.display="block",w.editFile(e,s.value).then((t=>{o.style.display="none",i&&(i.innerHTML=s.value),this.onEdit(e,s.value)}));t=!0,i=n.closest(".modal-header").querySelector(".modal-title"),r=n.closest(".modal-header").querySelector(".btn");const a=i.innerHTML;s.classList.add("invisible-input"),s.value=a,i.innerHTML="",i.append(s),s.focus(),r.innerHTML="Save",s.addEventListener("blur",(function(){i.innerHTML=a,r.innerHTML="Edit",setTimeout((e=>t=!1),500)}))}}_preview(e){return(t,s,i)=>{s.style.display="block";const r=i.querySelector(".modal-body .des");R.log(r);const n=document.createElement("img");w.preview(e).then((({uri:e})=>{n.src=e,n.classList.add("preview-img"),r.prepend(n),s.style.display="none"})).catch((e=>{}))}}_normalMode=async e=>{const t=await w.getFile(e);this.modalObject.buttons([{title:"delete",event:"delete",className:"delete btn btn-danger",dataAttrs:[{k:"mevent",v:"delete"}],callback:this.delete(e,t.originalName)},{title:t.isPublic?"Make private":"Make public",callback:this.switchPublic(e),event:"switchPublic",className:"switch btn btn-primary",dataAttrs:[{k:"mevent",v:"switchPublic"},{k:"id",v:t._id}]},{title:"download",event:"download",className:"download btn btn-success",callback:()=>{this._download(e)},dataAttrs:[{k:"mevent",v:"download"},{k:"id",v:t._id}]},{title:"",hidden:!0,event:"setViewer",className:"",callback:this._applyViewer(e),dataAttrs:[{}]},{title:"",hidden:!0,event:"removeViewer",className:"",callback:this._removerViewer(e),dataAttrs:[{}]}]),this.modalObject.setData({fileId:e,mode:"normal"}),this.modalObject.dataList([{title:"Size: "+C(t.size),className:""},{title:`Date: ${k(t.uploadedAt)}`,className:""}]),this.modalObject.addBodyButtons([{title:"Open in new tab",event:"tab",className:"file-viewer btn btn-primary",callback:this._newTab(e),dataAttrs:[{k:"mevent",v:"tab"}]}]),this.modalObject.imgSrc(d.LB+t.imgSrc),this.modalObject.modalTitleProvide(t.originalName),this.modalObject.provideSearchField({type:"text",className:"search-users",callback:this._searchUsers(e)}),this.modalObject.addHeaderButtons([{title:"Edit",event:"edit",className:"btn btn-primary",dataAttrs:[{k:"mevent",v:"edit"}],callback:this._editFile(e)}]),this.modalObject.init(this.$root.$el)};_onlyViewersMode=async e=>{const t=e._id;this.modalObject.modalTitleProvide(e.originalName),this.modalObject.buttons([{title:"",hidden:!0,event:"setViewer",className:"",callback:this._applyViewer(t),dataAttrs:[{}]},{title:"",hidden:!0,event:"removeViewer",className:"",callback:this._removerViewer(t),dataAttrs:[{}]}]),"docx"!==e.type&&"doc"!==e.type&&-1===e.type.search("document")||this.modalObject.addButtons([{title:"Preview",hidden:!1,event:"preview",className:"btn btn-primary",callback:this._preview(t),dataAttrs:[{k:"mevent",v:"preview"}]}]),this.modalObject.provideSearchField({type:"text",className:"search-users",callback:this._searchUsers(t)}),this.modalObject.init(this.$root.$el)};async show(e,t="normal"){await this.modes[this.mode](e)}};var L=s(138);class N extends Error{static throwError(e){if(401===e.status)return L.log("Unauthorized"),E.O.logOut(),void Z.redirect("hello/start");E.O.logOut(),Z.redirect("hello/start")}}const A=new class{constructor(){this.listeners={}}subscribe(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].find((e=>e.toString()===t.toString()))||this.listeners[e].push(t);const s=this,i=t;return{unsubscribe(){s.listeners[e]=s.listeners[e].filter((e=>e.toString()===i.toString()))}}}emit(e,t){setTimeout((()=>{if(this.listeners[e])return this.listeners[e].forEach((e=>{e(t)})),this}),100)}};function j(e){return{type:"FILES_LOADED",payload:e}}function _(e){return{type:"FILES_PENDING",payload:e}}function P(e){return{type:"SET_UPLOADING_FILE",payload:e}}function D(e){return{type:"LOAD_FILE",payload:e}}s(138);var U=s(138);class I{constructor(){this.http=new a.E}async getRootFolders(){return await this.http.get(l.A.foldersUrl("getAll"))}async getFolderContent(e){return await this.http.get(l.A.foldersUrl("content"),{folderid:e})}moveFileToFolder=async(e,t,s)=>await this.http.put(l.A.foldersUrl("moveTo"),{folderId:t,fileId:e,previousFolderId:s});async getFolderInfo(e){return await this.http.get(l.A.foldersUrl("info"),{id:e})}async createFolder(e,t){return await this.http.post(l.A.foldersUrl("create"),{folderName:e,parentFolder:t})}async renameFolder(e,t){return await this.http.put(l.A.foldersUrl("rename"),{id:e,name:t})}async deleteFolder(e){return await this.http.delete(l.A.foldersUrl("delete"),{id:e})}}class M{$el={};callBacks=[];targetElement={};constructor(e){e&&(this.$el=n(e),this.$el&&this.$el.on("click",this._handler))}init(){const e=this.targetElement.clientRect();return this.$el.style({top:e.top+10+"px",left:e.left+10+"px",position:"absolute"}),this.$el.show().style({opacity:1}),this}attach(e){return this.targetElement=n(e),this}off(){this.$el.style({opacity:0}),setTimeout((()=>{this.$el.hide()}),500)}destroy(){this.$el.hide(),this.$el.html(""),this.targetElement={}}content(e){let{optionsArray:t,labelsArray:s}=e;return t=t||[],s=s||[],this.$el.html(""),this.callBacks=[],t=t.map((e=>(this.callBacks.push({role:e.role,cb:e.cb}),this._createOption(e)))),s=s.map((e=>`<p>${e.text}</p>`)),this.$el.html(t.join("")+s.join("")),this}addOption=e=>(this.$el.html(""),this.callBacks=[],this.callBacks.push({role:e.role,cb:e.cb}),this.$el.append(this._createOption(e)),this);_createOption(e){return`<p data-menuRole = ${e.role}>${e.title}</p>`}_handler=e=>{const t=n(e.target);this._getCb(t.data.menurole).cb(t)};_getCb(e){return this.callBacks.find((t=>t.role===e))}}class x{file(e){return n.create("li").attr("data-role","file").attr("data-fid",e)}folder(e,t){return n.create("li",{classes:"folder droppable"}).attr("data-role","folder").attr("data-fid",e).attr("ondragover","event.preventDefault()").html(t)}innerFolderContent(e){return n.create("ul").html(e)}}var H=s(138);class V{folderService=new I;fElements=new x;constructor(e,{spinner:t,overlay:s,fileModal:i,openFolders:r}){this.openFolders=r,this.menu=e,this.spinner=t,this.overlay=s,this.fileModal=i}run(e,t={files:"N"}){this.menu.attach(e),"folder"!==e.data.role?"file"===e.data.role&&this.menu.content({optionsArray:[{role:"show",title:"show",cb:t=>this.showFile(e)},{role:"remove",title:"remove",cb:t=>this.deleteFile(e)},{role:"edit",title:"edit",cb:t=>this.editFile(e)}]}).init():this.menu.content({optionsArray:[{role:"delete",cb:t=>this.deleteFolder(e),title:"Delete"},{role:"rename",cb:t=>this.renameFolder(e),title:"Rename"},{role:"childFolder",cb:t=>this.childFolder(e),title:"Create Folder"},{role:"folderInfo",cb:t=>this.folderInfo(e,t),title:"Get info"}]}).init()}deleteFolder=e=>{const{fid:t}=e.data;confirm("Are you sure?")&&this.folderService.deleteFolder(t),e.remove()};showFile=async e=>{const{fid:t}=e.data;this.spinner.show(),this.overlay.show(),this.fileModal.show(t,"normal"),this.overlay.hide(),this.spinner.hide()};renameFolder=e=>{const t=prompt("Provide new folders title",e.data.title),s=e.data.fid;s&&t&&this.folderService.renameFolder(s,t).then((s=>{alert("Success"),e.find(".folder-title").html(t),e.attr("title",t)})).catch((e=>H.log(e)))};deleteFile=e=>{const{fid:t}=e.data;confirm("Are you sure?")&&w.deleteOne(t).then((({msg:e})=>{alert(`File ${e.fileName} deleted`)})),e.remove()};childFolder=e=>{const{fid:t}=e.data,s=prompt(`You are creating folder in ${e.data.title}. Please provide the title`);this.folderService.createFolder(s,t).then((i=>{alert("Folder has been successfully created"),!this.openFolders.includes(t)&&e.find("ul").prepend(this.fElements.folder(i.id,s)),this.openFolders=this.openFolders.filter((e=>e!==t))}))};editFile=e=>{const t=prompt("Provide new title for this file"),{fid:s}=e.data;w.editFile(s,t).then((e=>{alert(e.msg)}))};folderInfo=async(e,t)=>{const{fid:s}=e.data,i=await this.folderService.getFolderInfo(s);alert(`Files: ${i.files}\n Size:${i.size}`)}}var B=s(138),W=s(4309);class q extends W.h{constructor(e={}){super(),this.props=e,this.xhr=new XMLHttpRequest}post(e,t){return this.xhr.open("POST",e),this.wrapXHR_TEST(this.xhr),this.xhr.send(t),this}get(){}onload(e){return this.xhr.onload=()=>{if(200!==this.xhr.status)throw"Something went wrong";e(this.xhr)},this}onprogress=e=>(this.xhr.onprogress=t=>{if(200!==this.xhr.status)throw"Something went wrong";e(t)},this)}class J{constructor(){this.xhrCore=new q}post(e,t){return this.xhrCore.post(e,t)}onload(e){return this.xhrCore.onload(e)}get onprogress(){return this.xhrCore.onprogress}}class Q{xhrService=new J;upload(e){return this.xhrService.post(l.A.filesUrl("upload"),e),this}onload(e){return this.xhrService.onload(e),this}progress(e){return this.xhrService.onprogress(e)}showProgress(e){return t=>{const s=t.loaded/t.total*100;e.width(s+"%")}}}var G=s(138);const z={drive:new $({components:[{mainComponent:class extends S{name="menu";authService=E.O;constructor(e,t){super(e,{...t,listeners:["click"]})}init(){super.init()}onClick(e){"logout"===n(e.target).data.role&&(this.authService.logOut(),this.hstore.clearState(),Z.redirect("hello/start"))}static className="menu"},child:class extends S{constructor(e,t){super(e,{...t,listeners:["click"],useRouterAPI:!0})}onClick(e){const t=n(e.target);this.callUserFunction(t.data.role,t)}init(){return this.emitter.subscribe("hidePaginator",(e=>this.$root.hide())),this.emitter.subscribe("filesLoaded",(e=>{e<2||(this.$root.show(),this.detectChanges(e))})),super.init()}destroy(){return super.destroy()}static className="paginator";static render=!0}},{mainComponent:class extends S{name="main";modal=null;isLoaded=!1;routerSub=null;constructor(e,t){super(e,{...t,listeners:["click","keyup"],changeDetectionOfReducer:"filesReducer",extractFromReducer:"files"}),this.auth=E.O}onClick(e){const t=n(e.target);this.callUserFunction(t.data.role,t,["close-modal","my"])}init(){this.routerSub=A.subscribe("qParamsChanged",(({params:e,prevParams:t})=>{const{page:s}=e,{page:i}=t;this.hstore.dispatch(_({page:s})),w.getFiles(s,this.hstore.getState(),!1).then(this.mainFetch.bind(this)).catch(N.throwError)}));const{page:e}=Z.qParams();this.hstore.dispatch(_({page:e})),T.onDelete=e=>{this.hstore.dispatch({type:"FILE_DELETED",payload:{fileId:e}})},T.onEdit=(e,t)=>{this.hstore.dispatch({type:"FILE_EDITED",payload:{fileId:e,newTitle:t}})},this.modal=T.init(O(),this.$root),w.getFiles(e||1).then(this.mainFetch.bind(this)).catch(N.throwError),super.init()}destroy(){return this.emitter.emit("hidePaginator",!0),this.emitter.emit("hideSelection",!0),this.routerSub.unsubscribe(),super.destroy()}onStateChanged(){}closeFunction(e){confirm("Do you really want to delete file forever?")&&w.deleteOne(e.data?.id).then((()=>this.hstore.dispatch({fileId:e.data?.id})))}async showfileFunction(e){U.log(e),super.removeEventListeners();const t=e.closest(".file-content").hide(),s=e.closest(".file").find("#fileSpinner").show();await this.modal.show(e.data.id),t.show(),s.hide()}mainFetch({files:e,pages:t}){this.isLoaded=!0,this.emitter.debounceEmit("filesLoaded",t,500);let{page:s}=Z.qParams();s=s||"1",this.hstore.dispatch(j({files:e,pages:t,page:s}))}static routable=!0;static className="main"},child:class extends S{constructor(e,t){super(e,{listeners:["click","input"],...t,changeDetectionOfReducer:"filesReducer",extractFromReducer:"filesToWatch"})}name="search";searchQuery="";input=null;user={};onInput({target:e}){this.searchQuery=e.value}onClick(e){const t=n(e.target);this.callUserFunction(t.data.role,t)}async showFunction(e){const t=await w.filesICanWatch();this.hstore.dispatch({type:"OBSERVABLE_FILES_LOADED",payload:t}),this.dropDownOptions.css("toggle","dpdn-active")}searchFunction(e){this.searchQuery&&w.searchFiles(this.searchQuery).then((e=>{this.hstore.dispatch(j(e))}))}init(){const{user:e}=this.hstore.getTestState("userReducer");return this.$root.find(".user-widget").append(e.name),this.useState(),this.dropDownOptions=this.$root.find(".dpdn-options"),this.input=this.$root.find("input"),super.init()}static className="search";static routable=!1}},class extends S{fileIdsToDelete=[];constructor(e,t){super(e,{...t,listeners:["click"]})}onClick({target:e}){this.callUserFunction(e.dataset.role,n(e))}deleteFunction(e){window.confirm(`Are you sure to delete ${this.fileIdsToDelete.length} selected files`),this.hstore.dispatch({type:"FILES_REMOVE_MANY",payload:{ids:this.fileIdsToDelete}}),this.$root.hide()}init(){return this.emitter.subscribe("showSelection",(e=>{e.length>0&&(this.$root.show(),this.fileIdsToDelete=e,this.detectChanges(this.fileIdsToDelete.length))})),this.emitter.subscribe("hideSelection",(e=>this.$root.hide())),super.init()}name="search";static className="selection";static routable=!1},class extends S{name="uploader";overlay=null;spinner=null;fileInput=null;uploadingFile=null;constructor(e,t){super(e,{...t,listeners:["click","change"],changeDetectionOfReducer:"uploadReducer",extractFromReducer:"uploadingFile"})}init(){this.uploaderService=new Q,this.file=this.$root,this.overlay=this.$root.find("#overlay"),this.spinner=this.$root.find("#spinner"),this.fileInput=this.$root.find("#file_input"),this.fileInput.on("change",this.prepareFile.bind(this)),super.init()}onChange(e){}onClick(e){const t=n(e.target);this.callUserFunction(t.data.role,t)}removeoneFunction(e){const{id:t}=e.data;this.uploadingFile=null,this.detectChanges(this.uploadingFile)}mainuploadFunction(e){this.spinner.show(),this.overlay.show();const t=new FormData,s=this.$root.find("#file-item").width(0);t.append("file",this.uploadingFile),this.uploaderService.upload(t).onload((e=>{this.uploadingFile=null,this.hstore.dispatch(P(null)),this.spinner.hide(),this.overlay.hide(),this.hstore.dispatch(j([]))})).progress(this.uploaderService.showProgress(s))}specifyFunction(e){this.fileInput.click()}prepareFile(){this.spinner.show(),this.overlay.show(),this.uploadingFile=this.fileInput.files[0],this.uploadingFile.uid=this.uid,this.hstore.dispatch(P({name:this.uploadingFile.name}));const e=this.$root.find("#file-item").width(0),t=new FileReader;t.readAsDataURL(this.uploadingFile),t.onprogress=this.uploaderService.showProgress(e),t.onload=e=>{this.spinner.hide(),this.overlay.hide()}}static className="uploader";static routable=!0},class extends S{openFolders=[];fileModal=null;file={};overlay=null;spinner=null;menu={};name="folders";constructor(e,t){super(e,{...t,listeners:["click","contextmenu","dragstart","drop","dragend"]}),this.folderService=new I}static className="folders";async onContextmenu(e){const t=n(e.target);e.preventDefault(),this.menuService.run(t)}onClick(e){e.stopPropagation(),this.menu.off();const t=n(e.target);this.callUserFunction(t.data.role,t)}onDragstart(e){const t=n(e.target).style({opacity:"0.3"});this.file={fid:t.data.fid,folderId:t.data.folderid,remove(){t.remove()},$el:t}}onDragEnd(e){n(e.target).style({opacity:"1"})}async onDrop(e){const t=n(e.target);if("folder"===t.data.role&&window.confirm("Do you really want to move file in folder")){await this.folderService.moveFileToFolder(this.file.fid,t.data.fid,this.file.folderId);const e=!!this.openFolders.find((e=>e.id===t.data.fid));if(e)return void t.find("ul").append(this.file.$el);this.file.remove()}}rootfolderFunction(e){const t=prompt("You are creating folder. Please provide the title");this.folderService.createFolder(t).then((({id:e})=>{alert("Folder has been successfully created"),this.$root.find(".directory-list").prepend((new x).folder(e,t))}))}async folderFunction(e){const t=this.openFolders.find((t=>t.id===e.data.fid));if(t&&!t?.isEmpty)return e.css("toggle","active");if(t)return;this.spinner.show(),this.overlay.show();const s=await this.folderService.getFolderContent(e.data.fid);this.spinner.hide(),this.overlay.hide(),s.html&&e.append((new x).innerFolderContent(s.html)).css("toggle","active"),this.openFolders.push({id:e.data.fid,isEmpty:!s.html})}destroy(){return this.menu.destroy(),this.openFolders=[],this.modal=null,this.overlay=null,this.spinner=null,this.menu={},super.destroy()}init(){this.spinner=this.$root.find(".lds-hourglass"),this.overlay=this.$root.find(".overlay-forSpinner"),this.menu=new M(".hmenu"),T.onEdit=(e,t)=>{this.$root.find(`[data-fid=${e}]`).html(t)},this.fileModal=T.init(O(),this.$root),this.menuService=new V(this.menu,{spinner:this.spinner,overlay:this.overlay,openFolders:[...this.openFolders],fileModal:this.fileModal}),this.fetching(),super.init()}fetching(){return this.openFolders=[],this.detectChanges(""),this.folderService.getRootFolders().then((e=>{this.detectChanges(e.html)})).catch(N.throwError)}static routable=!0;static className="folders"}]}),hello:new $({components:[class extends S{login="";password="";auth=E.O;constructor(e,t){super(e,{...t,listeners:["submit","click"]}),this.some=3}onClick(e){const t=n(e.target);this.callUserFunction(t.data.role,t)}logFunction(e){this.login=this.$root.find("[hinput=login]"),this.password=this.$root.find("[hinput=password]"),this.auth.login(this.login.val(),this.password.val()).then((e=>{this.hstore.dispatch({type:"USER_ENTERED",payload:e}),Z.redirect("drive/main")})).catch((e=>{B.log(e),this.errorContainer.html(e.message)})).finally((e=>{this.login.val(""),this.password.val("")}))}init(){this.hstore.clearState(),this.errorContainer=this.$root.find("div[herror]"),E.O.isAuth.then((e=>{e&&Z.navigate("drive/main")})),super.init()}destroy(){return super.destroy()}static className="start";static routable=!0},class extends S{constructor(e,t){super(e,{...t,listeners:["click"]})}init(){return super.init()}onClick(e){const t=n(e.target);this.callUserFunction(t.data.role,t)}auth=E.O;static className="register";static routable=!0;regFunction(e){this.login=this.$root.find("[hinput=login]"),this.password=this.$root.find("[hinput=password]"),this.auth.register(this.login.val(),this.password.val(),"John").then((e=>{Z.redirect("hello/start")})).catch((e=>{this.errorContainer.html(e.msg)})).finally((e=>{this.password.val("")}))}}]}),system:new $({components:[class extends S{loading=!1;isError=!1;file={};modal=null;constructor(e,t){super(e,{...t,changeDetectionOfReducer:"itemReducer",extractFromReducer:"file",listeners:["click"]})}onClick(e){this.callUserFunction(e.target.dataset.role,n(e.target))}init(){const e=Z.qParams().id;return this.loading=!0,this.modal=T.init(O(),this.$root,"onlyViewers"),this.detectChanges({userId:{}},this.loading,this.isError),w.getFile(e).then((e=>{e.size=C(e.size),e.uploadedAt=k(e.uploadedAt),this.file=e,this.hstore.dispatch(D({file:this.file,error:!1}))})).catch((e=>{G.log("ERROR"),this.hstore.dispatch(D({file:{data:null},error:!0}))})),super.init()}downloadFunction(e){w.download(this.file._id).then((()=>{const e={id:this.file._id,token:E.O.token},t=l.A.filesUrl("download",e),s=document.createElement("a");s.href=t,s.click(),s.remove()}))}viewersFunction(e){this.modal.show(this.file)}deleteFunction(){confirm(`Do you want to delete ${this.file.originalName}`)&&(this.hstore.dispatch({type:"FILE_PENDING"}),w.deleteOne(this.file._id).then((()=>{alert("File deleted"),this.hstore.dispatch(D({file:{data:null},error:!1})),Z.navigate("drive/main",{})})))}destroy(){return this.hstore.dispatch(D({file:{data:null},error:!1})),super.destroy()}static className="item";static routable=!0}]})};function Y(){const e=window.location.hash.split("?").pop();if(window.location.hash.split("?").length<2)return{};const t={};return e.split("&").forEach((e=>{const s=e.split("=");t[s[0]]=s[1]})),t}function K(e){return e?("#"===e[0]&&(e=e.split("#").pop()),e=function(e){if(e&&"string"==typeof e)return"#"+e.split("/")[0]+"/"+e.split("/")[1]}(e),window.location.hash=e,e):window.location.hash.split("?").shift()}var X=s(138);class Z{previousModuleRoute=null;optionsDto={initialRoute:"hello/start"};previousRoute="";prevParamsString=JSON.stringify(Y());constructor(e,t={}){this.options=t,this.routes=e,this.modules=z,this.currentModule=null,this.activatedRoute="hello/start",this.selector=n("#app")}init(){this.options.initialRoute&&K(this.options.initialRoute),this.handler(),window.addEventListener("hashchange",this.handler)}static get currentRoute(){return K()}handler=async()=>{try{const e=JSON.stringify(Y());if(this.activatedRoute=K(),e!==this.prevParamsString&&this.activatedRoute===this.previousRoute&&(A.emit("qParamsChanged",{params:Y(),prevParams:JSON.parse(this.prevParamsString)}),this.prevParamsString=e),this.previousRoute===this.activatedRoute)return;this.previousRoute=this.activatedRoute;let{module:t,component:s}=this.dispatchRoutes();await s.guard(),this.currentModule=this.modules[t.route],this.prevParamsString=JSON.stringify({data:null}),t.route!==this.previousModuleRoute&&(this.prevParamsString=JSON.stringify({data:null}),this.modules[this.previousModuleRoute]&&this.modules[this.previousModuleRoute].remove()),this.previousModuleRoute=t.route,s&&this.currentModule.pushRoute(s.route,this.options)}catch(e){X.error(e),Z.redirect("hello/start")}};dispatchRoutes(){const e=this.routes.find((e=>e.route===this.getRouteParts()[0]));let t=e.childRoutes.find((e=>e.route===this.getRouteParts()[1]));return t.redirect?(K(`${e.route}/${t.redirect}`),this):(t.guard&&"function"==typeof t.guard||(t.guard=e=>!0),{module:e,component:t})}getRouteParts(){const e=this.activatedRoute.slice(1).split("/");return""!==e[1]&&e[1]||(e[1]="$empty"),e}manageOptions(e){0!==Object.keys(e).length&&(e={...this.optionsDto,...e})}static redirect(e){K(e)}static qParams(){return Y()}static navigate(e,t){const s=e||K(),i=Z.qParams();K(l.A.resolveQueryString(s,{...i,...t}))}static routerLink(e,t){const s={url:e=e||window.location.href.split("?")[0],qParams:t};return JSON.stringify(s)}}},6010:(e,t,s)=>{"use strict";var i=s(8546),r=s(2549);const n=[{route:"drive",childRoutes:[{route:"$empty",redirect:"uploader"},{route:"main",guard:o,additionalComponents:["paginator"]},{route:"folders",guard:o},{route:"uploader",guard:o}],guard:o},{route:"hello",childRoutes:[{route:"register"},{route:"start"}]},{route:"system",childRoutes:[{route:"item"}]}];function o(){return r.O.isAuth}new i.F(n,{initialRoute:"drive/main"}).init()}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return s[e](n,n.exports,r),n.exports}r.m=s,e=[],r.O=(t,s,i,n)=>{if(!s){var o=1/0;for(h=0;h<e.length;h++){for(var[s,i,n]=e[h],a=!0,l=0;l<s.length;l++)(!1&n||o>=n)&&Object.keys(r.O).every((e=>r.O[e](s[l])))?s.splice(l--,1):(a=!1,n<o&&(o=n));if(a){e.splice(h--,1);var c=i();void 0!==c&&(t=c)}}return t}n=n||0;for(var h=e.length;h>0&&e[h-1][2]>n;h--)e[h]=e[h-1];e[h]=[s,i,n]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,s)=>(r.f[s](e,t),t)),[])),r.u=e=>({139:"6e67d236e1977a06921a",297:"dbad6ab85fd62ead06d6",387:"1f1c870bb79b8241eebd",595:"6c89579b1a414130b6c9",638:"d16160e5904266eb6c47",711:"a2491ddc719717b8663d",779:"08e74ab7cd22bd4cb6d7",800:"ebdf3bba4a43a06bf4d6",826:"e93dd10fca1fd59e7a41",910:"9d7e6e909090e7571631",947:"177b51f7e8e1ee5955c3"}[e]+".bundle.js"),r.miniCssF=e=>(179===e?"main":e)+".css",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},r.l=(e,s,i,n)=>{if(t[e])t[e].push(s);else{var o,a;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var h=l[c];if(h.getAttribute("src")==e){o=h;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.src=e),t[e]=[s];var d=(s,i)=>{o.onerror=o.onload=null,clearTimeout(u);var r=t[e];if(delete t[e],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(i))),s)return s(i)},u=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),a&&document.head.appendChild(o)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={179:0};r.f.j=(t,s)=>{var i=r.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var n=new Promise(((s,r)=>i=e[t]=[s,r]));s.push(i[2]=n);var o=r.p+r.u(t),a=new Error;r.l(o,(s=>{if(r.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var n=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",a.name="ChunkLoadError",a.type=n,a.request=o,i[1](a)}}),"chunk-"+t,t)}},r.O.j=t=>0===e[t];var t=(t,s)=>{var i,n,[o,a,l]=s,c=0;if(o.some((t=>0!==e[t]))){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(l)var h=l(r)}for(t&&t(s);c<o.length;c++)n=o[c],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(h)},s=self.webpackChunk=self.webpackChunk||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=r.O(void 0,[203],(()=>r(6010)));n=r.O(n)})();